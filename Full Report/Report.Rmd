---
title: "Report - Full"
author: "Max Austin - Mada 2"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)

#install.packages("tinytex")
#tinytex::install_tinytex()

#install.packages("readr")
library(readr)

#install.packages("dplyr")
library(dplyr)

#install.packages("tidyr")
library(tidyr)

#install.packages("stringr")
library(stringr)

#install.packages("ggplot2")
library(ggplot2)

#install.packages("viridis")
library(viridis)

#install.packages("treemap")
library(treemap)


#install.packages("corrplot")
library(corrplot)

#install.packages("cluster")
library(cluster)


#install.packages("factoextra")
library(factoextra)

#install.packages("knitr")
library(knitr)

#install.packages("igraph")
library(igraph)

#install.packages("ggraph")
library(ggraph)

#install.packages("tidygraph")
library(tidygraph)


#install.packages("reticulate")
#install.packages("tensorflow")
#install.packages("keras")
library(reticulate)
#reticulate::virtualenv_remove("r-tensorflow")
library(keras)
#keras::install_keras(method = "virtualenv", envname = "r-tensorflow")
#reticulate::use_virtualenv("r-tensorflow", required = TRUE)
library(keras)
library(tensorflow)
#reticulate::py_config()
#tf$constant("Hello TensorFlow!")


```
# Introduction

This report analyzes United Kingdom's international trade activity during 1995-2023 from CEPII BACI database data. The principal aim is to test whether future trade data—total trade, imports and exports, trade flows by partner country and product—can be predicted accurately using novel data-driven approaches. Through this, this document provides valuable answers to key questions: Will the overall trade volume of the UK increase or decrease over the next years? Which goods and trading partners are most likely to dominate future patterns of trade? And what are the difficulties of trying to predict long-term trade statistics?

The original data set, containing more than 258 million observations of trade between 238 countries and 5,000 products, is trimmed to concentrate on the UK as importer and exporter. The process goes through four stages: data discovery and visualization, correlation analysis of trade variables, clustering to identify natural groupings between products and countries, and finally, deep learning models that have been trained to provide forecasts of future trade values. This systematic procedure not only allows for logical forecasting but also yields insights into the underlying forces driving UK trade.



# Exploration and Visualisation




```{r include=FALSE}
## Data import and processing
col_spec <- cols(
  k = col_character(),  
  t = col_double(),     
  i = col_double(),
  j = col_double(),
  v = col_double(),
  q = col_double()
)

files <- list.files(pattern = "*.csv")
data_list <- lapply(files[1:29], function(file) {
  read_csv(file, col_types = col_spec)
})
country_codes <- read_csv("codes/country_codes_V202501.csv")
product_codes <- read_csv("codes/product_codes_HS92_V202501.csv")  

rename_columns <- function(data) {
  data <- data %>%
    rename(
      year = t,          # 't' to 'year'
      exporter = i,      # 'i' to 'exporter'
      importer = j,      # 'j' to 'importer'
      product = k,       # 'k' to 'product'
      value = v,         # 'v' to 'value'
      quantity = q       # 'q' to 'quantity'
    )
  return(data)
}

data_list <- lapply(data_list, rename_columns)


combined_data <- bind_rows(data_list)
### 258605562 obs

rm(data_list)
gc()
combined_data <- combined_data %>%
  filter(exporter == "826" | importer == "826") 
### 13367259 obs

replace_country_codes <- function(data) {
  data <- data %>%
    mutate(exporter = as.character(exporter),
           importer = as.character(importer)) %>%
    
    left_join(country_codes %>% 
                mutate(country_code = as.character(country_code)) %>%  
                select(country_code, country_name) %>% 
                rename(exporter_name = country_name), 
              by = c("exporter" = "country_code")) %>%
    mutate(exporter = exporter_name) %>%
    select(-exporter_name) %>%  
    left_join(country_codes %>% 
                mutate(country_code = as.character(country_code)) %>%  
                select(country_code, country_name) %>% 
                rename(importer_name = country_name), 
              by = c("importer" = "country_code")) %>%
    mutate(importer = importer_name) %>%
    select(-importer_name)  

  return(data)
}

combined_data <- replace_country_codes(combined_data)


replace_product_codes <- function(data) {
  data <- data %>%
    mutate(product = as.character(product)) %>%
    
    left_join(product_codes %>% 
                mutate(code = as.character(code)) %>%  
                select(code, description),  
              by = c("product" = "code")) %>%
    
    mutate(product = description) %>%
    select(-description)  
    
  return(data)
}

combined_data <- replace_product_codes(combined_data)

remove_description_from_product <- function(data) {
  data <- data %>%
    mutate(product = sub(":.*", "", product))  

  return(data)
}

combined_data <- remove_description_from_product(combined_data)

merge_petroleum_rows <- function(data) {
  petroleum_data <- data %>%
    filter(grepl("petroleum", product, ignore.case = TRUE)) %>%
    group_by(year, exporter, importer) %>%
    summarise(
      value = sum(value, na.rm = TRUE),
      quantity = sum(quantity, na.rm = TRUE),
      product = "Petroleum Products",  
      .groups = "drop"
    )
  
  # Now remove the original petroleum rows and add the merged row
  data <- data %>%
    filter(!grepl("petroleum", product, ignore.case = TRUE)) %>%
    bind_rows(petroleum_data)
  
  return(data)
}

combined_data <- merge_petroleum_rows(combined_data)

merge_rows_by_group <- function(data) {
  data <- data %>%
    group_by(year, exporter, importer, product) %>%
    
    summarise(
      value = sum(value, na.rm = TRUE),
      quantity = sum(quantity, na.rm = TRUE),
      .groups = "drop"
    )
    
  return(data)
}

combined_data <- merge_rows_by_group(combined_data)
### 4958186 obs

uk_exporter_data <- combined_data %>%
  filter(exporter == "United Kingdom")
### 3385077 obs

uk_importer_data <- combined_data %>%
  filter(importer == "United Kingdom")
### 1588878 obs

importsum = sum(uk_importer_data$value)
exportsum = sum(uk_exporter_data$value)


```






Before any useful analysis can be performed, the raw trade data set must be processed into a usable form. The original data set, which was retrieved from the CEPII BACI database, includes over 258 million observations of international trade. To narrow the focus to the UK, all rows where the UK was either the importer or exporter were taken, reducing the data set to 13,367,259 observations.

Trade goods are stated in the 6-digit level Harmonized System (HS), and countries utilize numeric codes. These were translated into human-readable tags for easier reading. Another region where simplification can be done at this stage is that a great many items were encountered that were part of unnecessary or overly disaggregated product categories. For instance, there were 21 distinct types of meats, 5 distinct product categories for eggs, and quite a few distinct coffee-related categories. These have been grouped together into more general product classes wherever it is possible.

After consolidation and further cleaning, the dataset was reduced to 4,958,186 observations. The cleaned dataset represents approximately`r (4973955 / 258605562 * 100)`% of the original global dataset. 3,385,077 observations are UK exports, and 1,588,878 are UK imports.

Though this would at first glance suggest that the UK exports more than it imports in terms of volume of transactions, the value of trade paints a different picture. The aggregate value of UK imports during this period is `r importsum`, whereas the aggregate value of exports is `r exportsum`, with a resultant overall trade balance of `r exportsum - importsum`.

```{r include=FALSE}
# Remove all objects from the environment except 'combined_data' to reduce memory usage
rm(list = setdiff(ls(), c("combined_data")))
gc()  # Run garbage collection to free up unused memory

```

# Visualisation

## Trade value over time

Figure X shows United Kingdom's aggregate export, import, and net trade values during the period between 1995 and 2022. On the chart are export values marked in purple, import values shown in teal, and the yellow-colored net trade balance (subtracting imports from exports).

Main Observations:
Consistent growth with gaps
Both export and import values grow consistently from 1995 to around 2008. The trend continues after the Global Financial Crisis but with ups and downs, specifically from 2010 to 2020.

Persistent Trade Deficit:
Imports are always greater than exports, as depicted by the teal line remaining above the purple line. The net trade line (yellow) is negative for the whole time period and depicts a steep downward trend, especially from 2015, showing a broadening trade deficit.

Significant Economic Events
In the period around 2008–2009, both imports and exports fall sharply as a result of the Global Financial Crisis. The same drop is seen in 2020 in the COVID-19 pandemic, with recovery shortly thereafter.

Brexit Impact:
After 2016, export growth seems to plateau while imports are relatively stable. This decoupling could be due to higher trade barriers or market uncertainty resulting from the UK's withdrawal from the European Union.

Interpretation:
The graph shows the UK's structural trade deficit over the last three decades. While integration with the world and economic rebound from repeated economic shocks have occurred, the enduring trade deficit and worsening net worth are a concern in terms of sustainability. As explained earlier, the widening gap can be reflective of growing dependence on imports, declining export competitiveness, or policy challenges caused by events such as Brexit. These patterns create important background for forecasting and fuel the need for predictive modeling further in this report.

``` {r}
combined_data %>%
  filter(exporter == "United Kingdom" | importer == "United Kingdom") %>%
  group_by(year) %>%
  summarise(
    export_value = sum(value[exporter == "United Kingdom"], na.rm = TRUE),
    import_value = sum(value[importer == "United Kingdom"], na.rm = TRUE),
    net_value = export_value - import_value,
    .groups = "drop"  
  ) %>%
  gather(key = "type", value = "value", export_value, import_value, net_value) %>%
  ggplot(aes(x = year, y = value, color = type)) +
  geom_line(size = 1) +
  scale_color_viridis(discrete = TRUE) +  
  labs(title = "Export, Import, and Net Value Over Time", x = "Year", y = "Value") +
  theme_minimal() +
  theme(legend.title = element_blank())  
```

# Export Value by Top Importing Countries (1995–2022)
Figure X is a stacked area chart that illustrates the value of UK exports to its top 10 importers between 1995 and 2022. Each color band is a different country and allows relative and absolute trends in exports to be visually discerned.

Observations:
Long-Term Rise with Periodic Shocks:
UK exports experienced consistent growth between the mid-1990s and late 2000s, with peaks considerably in 2008, 2015, and also in 2021. Sharp declines in 2008–2009 and 2020 correspond to the Global Financial Crisis and the COVID-19 pandemic, respectively.

USA and European dominance
The US leads in exporting British goods by the largest proportion throughout the period, followed closely by other leading EU economies such as Germany, the Netherlands, and France. They are consistently rated as the best markets for British goods.

Growing Role of Asia:
Exports to China and Hong Kong SAR have grown steadily year on year, indicating a shift towards more participation in Asian economies. Although still less voluminous than those of the US or EU, it is proof of ongoing diversification in trade ties.

Brexit Implications
While exports to EU countries are strong, highly volatile after 2016. This might be because of Brexit-induced regulatory changes, supply chain reconfigurations, or new trade agreements affecting the UK's access to the European market.

Interpretation
This visualization emphasizes the UK's dependency on a small group of main trading partners and its success at gradually establishing new markets. Despite economic turmoil and political shifts such as Brexit, the UK export profile has remained strong, diversification acting as a buffer against external shocks. Continued growth within Asian markets and sustained performance within North America may be required to offset future troubles within Europe.

``` {r}
combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(year, importer) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  group_by(year) %>%
  mutate(rank = dense_rank(desc(total_export_value))) %>%
  filter(rank <= 10) %>%  
  ungroup() %>%  
  complete(year, importer, fill = list(total_export_value = 0)) %>%  
  ggplot(aes(x = year, y = total_export_value, fill = importer)) +
  geom_area(alpha = 0.6) +  
  scale_fill_viridis(discrete = TRUE) +  
  labs(title = "Export Value Over Time by Top 10 Importers", x = "Year", y = "Export Value") +
  theme_minimal()
```

## Import value by top exporters

Figure X is a stacked area chart showing the UK's value of imports from its top 10 trading partners between 1995 and 2022. There is one color band per country, enabling overall import trends as well as analysis per country contribution.

Observations:
Long-Term Increasing Trend:
UK imports have risen exponentially during the past three decades, with sharp increases leading to peaks in 2008, 2015, and 2021. These turning points are generally aligned with world macroeconomic cycles.

Dominance of USA and European Suppliers
The United States is a consistent leader as a main exporter to the UK, with Germany, France, and the Netherlands ranking next. These countries form the mainstay of the UK import base, emphasizing strong transatlantic and intra-EU trade relationships.

China's Increasing Influence:
Chinese imports have grown exponentially, reflecting its emergence as the world's manufacturing hub. The phenomenon follows world trends and is the UK's increasing dependency on Asian supply chains.

Sensitivity to Economic Shocks:
The falls experienced about 2008 and 2020 coincide with the global financial crisis and the COVID-19 crisis, respectively. The falls indicate the sensitivity of UK imports to global external shocks.

Post-Brexit Continuity:
Despites political uncertainties, particularly post-Brexit, the UK's key EU trading partners have sustained strong export levels to the UK. This is possibly the resilience of pre-existing trade relations, even in the presence of regulatory adjustments.

Interpretation:
As previously described, UK trade patterns identify an increasingly global economy with ongoing reliance on a stable cluster of major trade partners. The continuity of sources of import—most importantly from Western Europe and North America—evinces established dependency within supply chains. Meanwhile, expanding Chinese presence marks ongoing structural adaptation in global trade. Such combined patterns serve to underscore the significance of trading strategies balancing each other in terms of ensuring stability in the face of future interruption.
```{r}
combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(year, exporter) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  group_by(year) %>%
  mutate(rank = dense_rank(desc(total_import_value))) %>%
  filter(rank <= 10) %>%  
  ungroup() %>%  
  complete(year, exporter, fill = list(total_import_value = 0)) %>%
  ggplot(aes(x = year, y = total_import_value, fill = exporter)) +
  geom_area(alpha = 0.6) +  # Stacked area chart
  scale_fill_viridis(discrete = TRUE) +  
  labs(title = "Import Value Over Time by Top 10 Exporters", x = "Year", y = "Import Value") +
  theme_minimal()
```

## export value by top products
Figure X is a stacked area chart illustrating the export value of the UK's top 10 product categories from 1995 to 2022. This visualization facilitates comparison of dominant industrial sectors and their contribution to the UK export economy over nearly three decades.

Key Observations:
Long-Term Growth with Cyclical Peaks:
Export values record overall growth in the period studied, with distinct peaks in 2008, 2015, and 2021. These are characteristic of economic cycles globally and signal that UK exports are closely aligned with global demand and the condition of international economies.

Vehicles and Petroleum Products as Pillars
Vehicles (yellow) have consistently represented the largest proportion of exports, fueled by the UK's robust automobile sector. Petroleum products have also been a major contributor, though more prone to volatility in demand and prices.

Aerospace and Pharmaceuticals Growth:
Medicaments and related products with aircraft (e.g., aircraft and spacecraft, turbo-jets) have shown steady growth, indicative of the UK's value-added, high-technology competitive advantage.

Economic Shock Effect
Sharp declines in export value near 2008 and 2020 correspond to the global financial crisis and the COVID-19 pandemic, respectively. These declines show the vulnerability of even robust export sectors to global disruptions.

Post-Brexit Recovery:
Even as the Brexit transition period brought uncertainty, the recovery in export values in 2021 and 2022 indicates initial recovery, possibly spurred by resumed global demand or trade realignments.

Interpretation:
As earlier mentioned, the UK's export structure relies heavily on a mix of high-technology manufacturing, pharmaceuticals, and energy products. Even though dominance by some groups such as vehicles will expose the trade balance to sectoral risks, the presence of diversified and strong sectors suggests the possibility of adapting and remaining stable. Monitoring such groups will be critical in monitoring developments in trade competitiveness and export resilience over time.

```{r}
combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(year, product) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  group_by(year) %>%
  mutate(rank = dense_rank(desc(total_export_value))) %>%
  filter(rank <= 10) %>%  
  ungroup() %>%  
  complete(year, product, fill = list(total_export_value = 0)) %>%  
  ggplot(aes(x = year, y = total_export_value, fill = product)) +
  geom_area(alpha = 0.6) +  
  scale_fill_viridis(discrete = TRUE) +  
  labs(title = "Export Value Over Time by Top 10 Products", x = "Year", y = "Export Value") +
  theme_minimal() 
```


## import value by top products

Figure X presents a stacked area graph of the UK's top 10 imported product categories between 1995 and 2022, offering insight into the shifting structure of the UK's import economy over the last three decades.

Key Observations:
Steady Import Growth:
The overall import value has increased considerably, with characteristic peaks circa 2008, 2015, and 2021. These fluctuations reflect both global economic conditions and shifting domestic demand.

Aerospace and Machinery Dominance:
Aircraft and other aeroplanes (purple), and data processing equipment and engines, consistently represent a significant proportion of total imports. These industries point to the UK's reliance on high-value industrial and technological imports from abroad.

Rising Pharmaceutical and Chemical Imports:
From the late 2010s, one can see a definite increase in the import value of medicaments and heterocyclic compounds. This likely reflects higher demand for medical and chemical products, possibly enhanced by the COVID-19 pandemic and rearrangement of healthcare supply chains.

Steady Presence of Petroleum and Jet Engines:
Imports of petroleum product and turbo-jets have remained relatively stable over the period. Despite their lower share, they still remain very important for energy and transport sectors. 

Interpretation:
As mentioned previously, the structure of UK trade specifies its dependence on foreign suppliers for high-value products—particularly those in aerospace, technological, and pharmaceutical sectors. This rising demand for high-technology imports may reflect the UK's shift towards a service economy, with high-value products imported from overseas to supply domestic industries.

```{r}
combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(year, product) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  group_by(year) %>%
  mutate(rank = dense_rank(desc(total_import_value))) %>%
  filter(rank <= 10) %>%  
  ungroup() %>%  
  complete(year, product, fill = list(total_import_value = 0)) %>%  
  ggplot(aes(x = year, y = total_import_value, fill = product)) +
  geom_area(alpha = 0.6) +  
  scale_fill_viridis(discrete = TRUE) +  
  labs(title = "Import Value Over Time by Top 10 Products", x = "Year", y = "Import Value") +
  theme_minimal() 
```
## Treemap of exports by product

Figure X represents a treemap of the top 25 exports of the United Kingdom, offering a picture of the sectors composing the spine of the nation's international trade basket.

Noteworthy Observations:
Preponderance of Auto Sector:
Motor cars possess the largest slice of space on the map, owing to their status as the most-valued UK export industry. It signals the automotive production bed within the nation which is highly entrenched and how well-developed this aspect is for the entire country economy. 

Pharmaceutical and Energy Exports
Medicaments are second, reflecting the growing world demand for pharmaceuticals produced in the UK. Petroleum products also represent a significant proportion, highlighting the UK's ongoing dominance in energy production and supply.

Industrial and Aerospace Capabilities:
Aircraft and spacecraft, engines, turbines, and metals all feature prominently, highlighting the UK's high-tech manufacturing capability and role in world industrial supply chains.

Specialised and High-Tech Goods:
Exports such as whiskies, turbo-jets, heterocyclic compounds, and data processing machinery highlight the competitive edge of the UK in niche markets, particularly chemicals, aviation, and information technology.
As previously observed, the UK export economy is diversified and positionally positioned in high-value, innovation-driven industries. The treemap shows how industries such as motor, pharmaceuticals, energy, and aerospace are pillar industries of export resilience. Such diversification in products could confer immunity from sector-specific declines and world shocks.

```{r}
combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(product) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(25, total_export_value) %>%  
  treemap(
    dtf = .,  
    index = c("product"), 
    vSize = "total_export_value",  
    vColor = "total_export_value",  
    draw = TRUE,
    title = "Top 25 UK Export Products"
  )

```
## Top 25 UK Import Products

A treemap of the United Kingdom's top 25 import commodities is presented in Figure X to give insight into the leading sectors driving demand for international goods.

Key Findings:
Automotive and Energy Dependence:
Vehicles form the greatest percentage of UK imports, indicating the nation's continued reliance on overseas auto manufacturers. Petroleum goods also make up a significant percentage, indicating the UK's reliance on overseas energy sources considering local production.

Industrial and Technological Needs:
Metals, oil, and machinery are the principal contributors, a reflection of UK industry's raw materials and capital goods needs. Moreover, commodities such as data processing equipment, electronic circuits, and transmission apparatus demonstrate the crucial role of technology and infrastructure-related imports.

Pharmaceuticals and Aerospace:
Medicines have high import value, in line with export-side value of pharmaceuticals and reflecting world supply chain interdependence. Aircraft, engines, and turbines contribute to the presence of the aerospace industry on both sides of UK trade as well.

Consumer Goods:
Imports such as wine, footwear, and food preparations reflect strong consumer demand and lifestyle-led importation. These products sustain a heterogeneous home market with international goods.
As noted before, the UK boasts a diversified and extensive trade landscape. Its import landscape is shaped by both industrial inputs as well as technologically sophisticated elements, alongside traditional consumer goods. This not only reflects a vigorous global interdependency but also draws attention to Britain's vulnerability in the face of global supply networks in key industries such as vehicles, drugs, and manufacturing.


```{r}
combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(product) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(25, total_import_value) %>% 
  treemap(
    dtf = .,  
    index = c("product"),  
    vSize = "total_import_value",  
    vColor = "total_import_value",  
    draw = TRUE,
    title = "Top 25 UK Import Products"
  )
```

## treemap of exports by importer

Figure X illustrates the top 25 countries for UK export destinations, giving a complete picture of the nation's most significant trade partners.

Key Observations:
Dominant Partners:
USA and Germany were the two largest export markets, reflecting established trade relationships with the UK. They are followed closely by large EU economies like France, Netherlands, Ireland, and Belgium, affirming the continued relevance of Europe despite post-Brexit realignments.

EU and Non-EU Balance:
A considerable proportion of the top destinations remains in the EU, however, but other non-EU destinations such as China, United Arab Emirates, Australia, and Japan are also highly ranked, reflecting effective diversification of trade outside the EU market.

Emerging Markets:
India, Turkey, and South Korea are considered emerging or growing trade partners, reflecting the UK's shift to high-growth markets in the Middle East and Asia.
As mentioned above, the UK possesses a very diversified export profile. Despite classical Western economies dominating in terms of value, the fact that emerging markets are represented in the top 25 shows that the UK is gradually rebalancing its export policy. This shift could be based on evolving world demand, changing post-Brexit trade arrangements, or deliberate policy measures to diversify overseas.

```{r}
combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(importer) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(25, total_export_value) %>%  
  treemap(
    dtf = .,  
    index = c("importer"),  # Group by importer (destination country)
    vSize = "total_export_value", 
    vColor = "total_export_value",  
    draw = TRUE,
    title = "Top 25 UK Export Destinations"
  )
```

## treemap of exports by importer

Figure X lists the UK's top 25 import-supplying nations, giving an indication of the country's most significant sources of imports.

Key Points:

Major Suppliers:
Germany and China are the UK's most significant sources of imports, reflecting their central role in supplying industrial inputs, machinery, and electronics. The USA and the Netherlands also feature, reflecting close transatlantic relationships and logistics trade flows across Europe.

EU and International Balance:
A high percentage of major import partners are members of the EU, including France, Belgium, Italy, and Ireland, indicating the UK's increasing integration with European supply chains. However, the huge contributions from non-members of the EU like Japan, South Korea, and India indicate a global sourcing strategy that is extended. 

Diversified Supply Chain:
That countries like Switzerland, Norway, Turkey, and the Russian Federation are also represented only goes to underscore the UK's reliance on a broad geographical spectrum of suppliers for sectors like pharmaceuticals, raw materials, and energy.

Interpretation:
As indicated heretofore, the UK's trade profile exhibits an extremely diversified structure. On the imports front, such diversification ensures immunity to global disruptions or regional trade tensions across the world. That it now has both traditional European partners and new Asian suppliers is a reflection of the fact that the UK is actively redesigning its import policies to reflect the demands of a post-Brexit, globalized world.
```{r}
combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(exporter) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(25, total_import_value) %>% 
  treemap(
    dtf = .,  
    index = c("exporter"), 
    vSize = "total_import_value", 
    vColor = "total_import_value",  
    draw = TRUE,
    title = "Top 25 UK Import Sources"
  )
```
## Top 5 Goods Exported, and who they are exported to

Figure X illustrates the top 5 products exported by the UK to each of its top 5 importing countries, offering a detailed view of bilateral trade flows and the specific products that are powering export relationships.

Key Observations:

Vehicles Dominate:
Vehicles are the most exported product by far, especially to the USA and Germany, followed by Belgium, China, and France. This reflects the central role played by the UK's automotive industry in international trade.

Energy and Industrial Exports:
Oils and petroleum products also feature strongly, with large exports to Germany, the USA, the Netherlands, and Ireland. These help to highlight the importance of the UK's energy sector and industrial base in its export basket.

Pharmaceutical and Metal Exports:
Medicaments are concentrated in exports to the USA and Germany, indicating high demand for pharmaceuticals. Metals, however, are heavily directed to Switzerland, perhaps as a world trading or refining hub, and other Asian and Western economies. 

Interpretation:
This chart confirms the UK's reliance on a relatively small group of high-value products, such as vehicles, petroleum, and pharmaceuticals, in exports to its principal partners. As indicated earlier, while there is geographic diversification, concentration in a small number of product categories can expose UK exports to sector-specific weakness and shifting global demand.
```{r}
top_export_goods <- combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(product) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(5, total_export_value)

combined_data %>%
  filter(exporter == "United Kingdom" & product %in% top_export_goods$product) %>%
  group_by(product, importer) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  group_by(product) %>%
  top_n(5, total_export_value) %>%
  ggplot(aes(x = reorder(importer, total_export_value), y = total_export_value, fill = importer)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~product, scales = "free_y") +
  labs(title = "Top 5 Goods We Export to the Top 5 Importers",
       x = "Importer Country", y = "Total Export Value") +
  theme_minimal() +
  theme(legend.position = "none")
```

## Top 5 imported goods, and who they are imported from

Figure X also illustrates the UK's top 5 imports from its top 5 exporting countries, giving detailed insight into what underpins inbound trade volumes.

Key Findings:

Vehicles as Central Imports:
Vehicles are the biggest import category, headed by Germany, with major contributions also from Belgium, Japan, Spain, and France. This highlights the UK's heavy dependence on European car manufacturing.

Energy Dependence:
Petroleum products and oils are important imports. Norway is the leading supplier in both categories, followed by the USA, Russian Federation, and some Middle Eastern and African countries. This reflects the UK's global sourcing strategy for key energy resources.

Raw Materials and Industrial Inputs
Metals arrive in from a wide range of geographical areas like North America (USA, Canada), Africa (South Africa), and Europe (Switzerland, Russia), highlighting the geographic diversity of key industrial goods.

Explanation:
As previously discussed, the UK follows a very internationalized pattern of imports with strong dependences across industries like energy, cars, and metals. The visualization above reinforces the importance of maintaining geopolitical and trading relations stable so as to continue supplying key commodities smoothly.
```{r}
top_import_goods <- combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(product) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(5, total_import_value)

combined_data %>%
  filter(importer == "United Kingdom" & product %in% top_import_goods$product) %>%
  group_by(product, exporter) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  group_by(product) %>%
  top_n(5, total_import_value) %>%
  ggplot(aes(x = reorder(exporter, total_import_value), y = total_import_value, fill = exporter)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~product, scales = "free_y") +
  labs(title = "Top 5 imported goods for the top 5 exporters",
       x = "Exporter Country", y = "Total Import Value") +
  theme_minimal() +
  theme(legend.position = "none")
```

# correlations
## Correlation Between Top Export Products

Figure X is a correlation matrix of the UK's top-selling export products, and it is a hint at how various industries behave together in their trends over time. The darker the circle, the higher the positive correlation of two product groups.

Key Points:

Industrial Grouping:
There are high correlations between products within the automobile and aerospace sectors—i.e., vehicles, engines, and aircraft and spacecraft. This means that trade performances of these sectors are strongly interdependent, likely due to shared supply chains, similar technology, or synchronized global demand cycles.

Raw Material Dependencies:
Metals and petroleum products also have high correlations, perhaps due to their central role in various industries. They are generally utilized as inputs for manufacturing, construction, and energy generation, and as such, their export patterns have a tendency to move together.

Pharmaceutical Linkages:
Medicaments have a moderate correlation with metals and petroleum, indicating upstream material dependencies or correlated market conditions, e.g., health care demands during global crises.

Mixed Signals in Niche Categories
Other products such as turbines, plastics, and oils have weaker and more varied correlations, implying that these goods are more likely to respond independently to world market trends, regulatory changes, or industry-specific patterns.
This knowledge is critical for policy-makers and trade analysts, for it reveals industrial sectors expected to be affected concurrently by economic changes. For forecasting, interdependence can improve the accuracy of models by allowing the application of product groupings with common behavior patterns.
```{r}
top_10_export_products_aggregated <- combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(product) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE)) %>%
  arrange(desc(total_export_value)) %>%
  top_n(10, total_export_value)

top_10_export_product_data_agg <- combined_data %>%
  filter(exporter == "United Kingdom" & product %in% top_10_export_products_aggregated$product) %>%
  group_by(year, product) %>%
  summarise(total_value = sum(value, na.rm = TRUE)) %>%
  spread(key = product, value = total_value)

export_correlation_matrix <- cor(top_10_export_product_data_agg[, -1], use = "complete.obs")

corrplot(export_correlation_matrix, method = "circle", type = "upper", tl.cex = 0.8)


```
## Correlation Between Top Import Products

Figure X displays a correlation matrix of the top import products of the UK, providing us with an insight into how volumes in different industries trend against one another.

Observations:

Technology & Automotive Synergy:
Strong positive correlations among cars, transmission equipment, and plastics exist, which reflect the interconnectedness of the auto and electronics supply chains. The products often share some components or processes, and as a result, their import patterns increase and decrease together.

Industrial Dependencies
Metals and petroleum products are highly correlated, validating their status as key inputs for a wide range of industrial applications, including construction, production, and energy.

Sector-Specific Import Patterns:
Medicaments and data processing equipment are less correlated with other imports, suggesting that their volumes of trade are influenced more by sector-specific demand—like health needs or technology cycles—than broader economic fluctuations. 

Divergent Movements:
Negative or weaker correlations reflect that certain products may exhibit trade-off behavior—for example, increases in one category of imports can be paired with reductions in another, perhaps because of shifts in domestic production, policy, or foreign supply shocks.

Interpretation:
This correlation matrix emphasizes the importance of recognizing interdependencies and independencies among UK imports. In policy planning and forecasting, being aware of which industries move together (or diverge) can enhance the credibility of projections and inform strategies for managing supply chain vulnerabilities.


```{r}
top_10_import_products_aggregated <- combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(product) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE)) %>%
  arrange(desc(total_import_value)) %>%
  top_n(10, total_import_value)

top_10_import_product_data_agg <- combined_data %>%
  filter(importer == "United Kingdom" & product %in% top_10_import_products_aggregated$product) %>%
  group_by(year, product) %>%
  summarise(total_value = sum(value, na.rm = TRUE)) %>%
  spread(key = product, value = total_value)

import_correlation_matrix <- cor(top_10_import_product_data_agg[, -1], use = "complete.obs")

corrplot(import_correlation_matrix, method = "circle", type = "upper", tl.cex = 0.8)
```
## Correlation Between UK Export Destinations (Importers of UK Goods)
Figure X illustrates the correlation matrix of the top importing nations for UK products, and it indicates the extent to which export volume to these nations has progressed in relation to each other.

Key Findings:

Strong Regional Clustering:
There is a clear grouping of European countries—Germany, France, Netherlands, Belgium, and Ireland—that maintain consistently high positive correlations. This reflects synchronized patterns of trade demands, which are most likely brought about by proximity, economic linkage, and similar trade agreements (e.g., historical EU membership).

USA and Switzerland:
The USA also shows relatively high correlations with European allies, particularly Germany and Netherlands, reflecting similar and stable demand for UK exports. Switzerland, while a significant destination, shows a slightly lower correlation pattern, reflecting more independent demand cycles.

China and Italy – Divergent Patterns:
China is also demonstrating a relatively weaker and even slightly reverse correlation with countries like Italy, suggesting that UK exports to China follow a divergent trend, perhaps driven by sector-specific or geopolitical rather than regional economic concerns.

Interpretation
As commented above, the UK's export base is regionally based in Europe, with high inter-country correlation across EU members. However, the inclusion of USA and China, whose behavior is less synchronized, gives validity to the argument that the UK has a diversified export strategy combining regional consistency with global reach. These correlation dynamics are vital when considering the stability and volatility of future trade flows.


```{r}
top_10_importers_aggregated <- combined_data %>%
  filter(exporter == "United Kingdom") %>%
  group_by(importer) %>%
  summarise(total_import_value = sum(value, na.rm = TRUE)) %>%
  arrange(desc(total_import_value)) %>%
  top_n(10, total_import_value)

top_10_importer_data_agg <- combined_data %>%
  filter(exporter == "United Kingdom" & importer %in% top_10_importers_aggregated$importer) %>%
  group_by(year, importer) %>%
  summarise(total_value = sum(value, na.rm = TRUE)) %>%
  spread(key = importer, value = total_value)

importer_correlation_matrix <- cor(top_10_importer_data_agg[, -1], use = "complete.obs")

corrplot(importer_correlation_matrix, method = "circle", type = "upper", tl.cex = 0.8)
```
# Correlation Between UK Import Sources (Exporters to the UK)

Figure X presents the correlation matrix of the top UK export partner nations, providing a sense of how closely their trade volumes move in tandem over time.

Key Observations:

Strong Co-Movement Among European Partners:
Major European exporters — including Germany, France, Netherlands, Ireland, Italy, and Belgium — are all highly positively correlated with one another. This is a reflection of the region's integrated supply chains and synchronized economic cycles, with trade volumes to the UK rising and falling together in tandem.

USA and China:
Although still positively linked with the European countries, the USA and China are somewhat more independently inclined, possibly indicating differences in trade structure, product clusters, or policy determinants outside. Their inclusion is a measure of the UK's reliance on suppliers across the world, outside its immediate sphere.

Norway's Special Role:
Norway exhibits high synchronization with its main European trading partners, but its importance likely differs by product (e.g., energy products like oil and gas), which creates minor divergences in the timing of its trade compared to more diversified exporters.

Interpretation:
As noted earlier, the UK has close trade integration with Europe, reflected in the strongly correlated trade flows within EU members. Meanwhile, countries such as China, USA, and Norway impart diversity to the UK's import base, providing resilience to regional disruption. The co-movements are instructive on both the commonalities of economic dependencies as well as vulnerabilities in the UK's import network.

```{r}
top_10_exporters_aggregated <- combined_data %>%
  filter(importer == "United Kingdom") %>%
  group_by(exporter) %>%
  summarise(total_export_value = sum(value, na.rm = TRUE)) %>%
  arrange(desc(total_export_value)) %>%
  top_n(10, total_export_value)

top_10_exporter_data_agg <- combined_data %>%
  filter(importer == "United Kingdom" & exporter %in% top_10_exporters_aggregated$exporter) %>%
  group_by(year, exporter) %>%
  summarise(total_value = sum(value, na.rm = TRUE)) %>%
  spread(key = exporter, value = total_value)

exporter_correlation_matrix <- cor(top_10_exporter_data_agg[, -1], use = "complete.obs")

corrplot(exporter_correlation_matrix, method = "circle", type = "upper", tl.cex = 0.8)
```

```{r include=FALSE}
##removing all unused data from the enviroment to save on ram

rm(list = setdiff(ls(), c("combined_data")))
gc()
```
# clustering

```{r}
# UK as Importer
uk_import_data <- combined_data %>%
  filter(importer == "United Kingdom")

# UK as Exporter
uk_export_data <- combined_data %>%
  filter(exporter == "United Kingdom")

# Top 20 exporters to UK
top_exporters <- uk_import_data %>%
  group_by(exporter) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(20, total_value) %>%
  pull(exporter)

# Top 20 import products
top_import_products <- uk_import_data %>%
  group_by(product) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(20, total_value) %>%
  pull(product)

# Top 20 importers from UK
top_importers <- uk_export_data %>%
  group_by(importer) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(20, total_value) %>%
  pull(importer)

# Top 20 export products
top_export_products <- uk_export_data %>%
  group_by(product) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  top_n(20, total_value) %>%
  pull(product)

exporter_matrix <- uk_import_data %>%
  filter(exporter %in% top_exporters) %>%
  group_by(exporter, year) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = year, values_from = total_value, values_fill = 0)

exporter_data <- exporter_matrix %>% select(-exporter)

set.seed(42)
exporter_clusters <- kmeans(exporter_data, centers = 4)

exporter_cluster_result <- exporter_matrix %>%
  mutate(cluster = exporter_clusters$cluster)

import_product_matrix <- uk_import_data %>%
  filter(product %in% top_import_products) %>%
  group_by(product, year) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = year, values_from = total_value, values_fill = 0)

import_product_data <- import_product_matrix %>% select(-product)

set.seed(42)
import_product_clusters <- kmeans(import_product_data, centers = 4)

import_product_cluster_result <- import_product_matrix %>%
  mutate(cluster = import_product_clusters$cluster)

importer_matrix <- uk_export_data %>%
  filter(importer %in% top_importers) %>%
  group_by(importer, year) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = year, values_from = total_value, values_fill = 0)

importer_data <- importer_matrix %>% select(-importer)

set.seed(42)
importer_clusters <- kmeans(importer_data, centers = 4)

importer_cluster_result <- importer_matrix %>%
  mutate(cluster = importer_clusters$cluster)

export_product_matrix <- uk_export_data %>%
  filter(product %in% top_export_products) %>%
  group_by(product, year) %>%
  summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = year, values_from = total_value, values_fill = 0)

export_product_data <- export_product_matrix %>% select(-product)

set.seed(42)
export_product_clusters <- kmeans(export_product_data, centers = 4)

export_product_cluster_result <- export_product_matrix %>%
  mutate(cluster = export_product_clusters$cluster)


##Visulasation
# Visualization for UK as Importer - Product Cluster
product_names_import <- import_product_cluster_result$product
product_values_import <- import_product_cluster_result %>%
  select(-product, -cluster) %>%
  as.matrix()
rownames(product_values_import) <- product_names_import

cor_matrix_import <- cor(t(product_values_import), use = "pairwise.complete.obs")
cor_edges_import <- which(upper.tri(cor_matrix_import) & cor_matrix_import > 0.8, arr.ind = TRUE)
edge_list_import <- data.frame(
  from = rownames(cor_matrix_import)[cor_edges_import[, 1]],
  to = rownames(cor_matrix_import)[cor_edges_import[, 2]]
)

node_info_import <- import_product_cluster_result %>%
  mutate(name = product,
         total_value = rowSums(select(., -product, -cluster), na.rm = TRUE)) %>%
  select(name, cluster, total_value)

graph_import <- graph_from_data_frame(d = edge_list_import, vertices = node_info_import, directed = FALSE)

# Visualization for UK as Exporter - Product Cluster
product_names_export <- export_product_cluster_result$product
product_values_export <- export_product_cluster_result %>%
  select(-product, -cluster) %>%
  as.matrix()
rownames(product_values_export) <- product_names_export

cor_matrix_export <- cor(t(product_values_export), use = "pairwise.complete.obs")
cor_edges_export <- which(upper.tri(cor_matrix_export) & cor_matrix_export > 0.8, arr.ind = TRUE)
edge_list_export <- data.frame(
  from = rownames(cor_matrix_export)[cor_edges_export[, 1]],
  to = rownames(cor_matrix_export)[cor_edges_export[, 2]]
)

node_info_export <- export_product_cluster_result %>%
  mutate(name = product,
         total_value = rowSums(select(., -product, -cluster), na.rm = TRUE)) %>%
  select(name, cluster, total_value)

graph_export <- graph_from_data_frame(d = edge_list_export, vertices = node_info_export, directed = FALSE)

# Visualization for UK as Importer - Exporter Cluster
exporter_names_import <- exporter_cluster_result$exporter
exporter_values_import <- exporter_cluster_result %>%
  select(-exporter, -cluster) %>%
  as.matrix()
rownames(exporter_values_import) <- exporter_names_import

cor_matrix_exporter_import <- cor(t(exporter_values_import), use = "pairwise.complete.obs")
cor_edges_exporter_import <- which(upper.tri(cor_matrix_exporter_import) & cor_matrix_exporter_import > 0.8, arr.ind = TRUE)
edge_list_exporter_import <- data.frame(
  from = rownames(cor_matrix_exporter_import)[cor_edges_exporter_import[, 1]],
  to = rownames(cor_matrix_exporter_import)[cor_edges_exporter_import[, 2]]
)

node_info_exporter_import <- exporter_cluster_result %>%
  mutate(name = exporter,
         total_value = rowSums(select(., -exporter, -cluster), na.rm = TRUE)) %>%
  select(name, cluster, total_value)

graph_exporter_import <- graph_from_data_frame(d = edge_list_exporter_import, vertices = node_info_exporter_import, directed = FALSE)

# Visualization for UK as Exporter - Importer Cluster
importer_names_export <- importer_cluster_result$importer
importer_values_export <- importer_cluster_result %>%
  select(-importer, -cluster) %>%
  as.matrix()
rownames(importer_values_export) <- importer_names_export

cor_matrix_importer_export <- cor(t(importer_values_export), use = "pairwise.complete.obs")
cor_edges_importer_export <- which(upper.tri(cor_matrix_importer_export) & cor_matrix_importer_export > 0.8, arr.ind = TRUE)
edge_list_importer_export <- data.frame(
  from = rownames(cor_matrix_importer_export)[cor_edges_importer_export[, 1]],
  to = rownames(cor_matrix_importer_export)[cor_edges_importer_export[, 2]]
)

node_info_importer_export <- importer_cluster_result %>%
  mutate(name = importer,
         total_value = rowSums(select(., -importer, -cluster), na.rm = TRUE)) %>%
  select(name, cluster, total_value)

graph_importer_export <- graph_from_data_frame(d = edge_list_importer_export, vertices = node_info_importer_export, directed = FALSE)

```


## Product Clustering – UK Imports

Figure X shows the United Kingdom's clustered import products network, divided by trade similarity and import value. By applying a graph-based clustering algorithm to correlation-weighted trade data, products have been grouped into four clusters. Nodes represent products, with node size indicating total import value and color showing cluster membership.

Cluster 1 (red) is more sparse with some highly specialized products such as metals, which have unique import profiles with minimal relationship to other clusters. Cluster 2 (green) is more dispersed with a broad array of less correlated products such as aeroplanes, diamonds, and data processing equipment—indicative of various sourcing strategies or market demands. Cluster 3 (cyan) is a highly connected, dense core formed by staple imports such as oils, petroleum products, plastics, and medicaments, which are essential to UK health and industry. Cluster 4 (purple) is centered on vehicles and extremely closely related components like engines, rubber, and steel, suggesting close internal trade relationships within the automotive supply chain.

Overall, this clustering reveals coherent structure in UK imports, dividing out closely related groups of products and more independent classes. These patterns can guide strategic planning and provide a crucial foundation for predictive models by highlighting areas of common economic activity.

```{r}
ggraph(graph_import, layout = "fr") +
  geom_edge_link(alpha = 0.2) +
  geom_node_point(aes(size = total_value, color = factor(cluster))) +
  geom_node_text(aes(label = name), repel = TRUE, size = 3) +
  theme_void() +
  labs(title = "Product Clusters - UK Imports", color = "Cluster", size = "Total Value")
```
## Product Clustering – UK Exports
Figure X illustrates the cluster network of UK export products, grouped by similarity in trade and overall export value. Four clusters resulted from a graph-based algorithm run over correlation-weighted exports. Similar to the imports chart, products are represented as nodes within this graph, total export value is represented by the size of nodes, and color indicates its corresponding cluster.

Cluster 1 (red) consists of a dense center of highly related products including plastics, whiskies, aircraft and spacecraft, machinery, and engines. The categories are highly interrelated and central to the UK's manufacturing and industrial export foundation. Cluster 2 (green) is more dispersed and consists of less related products including rubber, machines, and transmission apparatus—suggesting diverse sources of production and demand patterns. Cluster 3 (cyan) contains fewer significant exports like petroleum products, metals, and medicaments, which are typically pharma-related or resource-based. Cluster 4 (purple) is dominated by vehicles with strong connections to priority components like iron or steel, supporting the integrated supply chain of the automotive sector.

This grouping uncovers structural characteristics in the UK exporting economy, facilitating differentiation between closely interrelated industrial groups and more independent export groups. These insights are notably relevant for downstream predictive modeling, as they provide information on the interrelationship and dependence amongst goods exported.

```{r}
# Plot for UK as Exporter - Product Cluster
ggraph(graph_export, layout = "fr") +
  geom_edge_link(alpha = 0.2) +
  geom_node_point(aes(size = total_value, color = factor(cluster))) +
  geom_node_text(aes(label = name), repel = TRUE, size = 3) +
  theme_void() +
  labs(title = "Product Clusters - UK Exports", color = "Cluster", size = "Total Value")
```
## Exporter Clustering – UK Imports

Figure X shows the export country network to the UK, with countries grouped into clusters as a function of trade pattern similarity and overall import value. The clustering is from a correlation-weighted trade data graph with nodes being countries and edges being trade similarity. Node size is the overall import value from the country, with colors indicating cluster membership.

Cluster 1 (red) includes countries such as Switzerland, Canada, the Russian Federation, and Japan—relatively less integrated and more independent in their trade ties with the UK. Such exporters specialize in exporting high-value or specialized goods outside the UK's principal European trade web. Cluster 2 (green) revolves around Germany, Ireland, and Italy, forming a highly integrated set of major EU trading partners with high, stable trade flows. Cluster 3 (cyan) includes France, China, and the USA, which signifies a mix of regional and international exporters that export diversified products to the UK. Cluster 4 (purple) connects Belgium, Spain, and Poland, which signifies tight intra-European interdependency on trade.

This exporter clustering is a focus of geographical and structural UK trade dependencies. It provides a comparison between international suppliers of varying profiles and highly interdependent European trade bloc—a fascinating element for future forecasting trade flow and simulating import behavior.

```{r}
# Plot for UK as Importer - Exporter Cluster
ggraph(graph_exporter_import, layout = "fr") +
  geom_edge_link(alpha = 0.2) +
  geom_node_point(aes(size = total_value, color = factor(cluster))) +
  geom_node_text(aes(label = name), repel = TRUE, size = 3) +
  theme_void() +
  labs(title = "Exporter Clusters - UK Imports", color = "Cluster", size = "Total Value")
```
## Importer Clustering – UK Exports
Figure X is the UK's export destination network, aggregated by similarity of import behavior and total export value. Every node is a nation that imports from the UK, with node size indicating total export value and colors mapping different clusters from a graph-based algorithm applied to correlation-weighted data.

Cluster 1 (red) is very distinct importers such as Switzerland and China who maybe have specific trade patterns or specialist requirements. Cluster 2 (green) has all the major European partners such as Belgium, Ireland, and France and also Canada and India, with this capturing heavy and consistent patterns of trade to/from the UK. Cluster 3 (cyan) is defined by a heterogenous set of countries like the Netherlands, Australia, Poland, and Japan, reflecting heterogenous but moderately comparable import behaviors. Cluster 4 (purple) connects high-value destinations like Germany and the USA, reflecting their central role in the UK's export strategy to the world.

This clustering sheds light on how different countries interact with British exports, mapping closely aligned regional trade blocks alongside more world-wide dispersed partners. It is potentially valuable as context for classification and prediction issues in the deep learning phase where country-level tendencies can enhance performance.


```{r}
# Plot for UK as Exporter - Importer Cluster
ggraph(graph_importer_export, layout = "fr") +
  geom_edge_link(alpha = 0.2) +
  geom_node_point(aes(size = total_value, color = factor(cluster))) +
  geom_node_text(aes(label = name), repel = TRUE, size = 3) +
  theme_void() +
  labs(title = "Importer Clusters - UK Exports", color = "Cluster", size = "Total Value")
```
Product and trade partner clustering analysis shows latent structure in the UK trade network, separating between central industrial products, regionally integrated economies, and outlier specialists. Not only do the patterns offer economic intuition, but also they inform feature engineering of deep learning models. With clustering, capturing product- and country-level similarities, the predictive model better generalizes trade behavior and long-term predictions in trade value more accurate and reliable.



```{r include=FALSE}
#clenaing enviroment 
rm(list = setdiff(ls(), c("combined_data")))
gc()
```

# deep learning

## Methods

Two deep learning models were created to forecast UK trade values, one for when the United Kingdom is an importer and one for when it is an exporter. These models were implemented using the Keras API in TensorFlow (version 2.10.0) under the R environment. To prepare the data for modeling, all trade transactions worth less than 5,000 were removed in an effort to reduce noise and prevent the likelihood of overfitting. Categorical columns such as trade partners and product types were embedded to integers and passed through embedding layers to learn their internal representation. Numerical features such as trade year and trade value were normalized to have zero mean and unit variance.

Both models were trained using 30 epochs and a batch size of 216, selected after trying different combinations of hyperparameters. This configuration provided consistent stable performance and avoided convergence issues associated with larger or smaller batch sizes. Mixed precision training (with the mixed_float16 policy) was also enabled to improve training efficiency without sacrificing numerical accuracy.

The loss function used was mean squared error (MSE), with mean absolute error (MAE) tracked as a secondary performance measure. A validation split of 20% was used in training, and shuffling was enabled to aid generalization. Model performance was monitored while training via training history plots. Both models displayed steady convergence and minimal divergence between training and validation error curves, indicating high generalization and no overfitting evidence

```{r}
# SECTION 1: MIXED PRECISION
# Enable mixed precision (optional, if supported hardware)
policy <- tf$keras$mixed_precision$Policy("mixed_float16")
tf$keras$mixed_precision$set_global_policy(policy)

# =============================================================================
# 2) DATA PREPARATION
# =============================================================================
# combined_data has: year, exporter, importer, product, value, quantity
combined_data_dl <- combined_data %>%
  # drop quantity (unused)
  select(-quantity) %>%
  # denoise: remove very small trades
  filter(value >= 2500) %>%
  # log‐transform the value
  mutate(value = log1p(value))

# create lag_1, lag_2, lag_3 by exporter/importer/product groups
num_lags <- 3
generate_lags <- function(df, by_vars, value_var, n_lags) {
  for (lag in seq_len(n_lags)) {
    lag_name <- paste0("lag_", lag)
    df <- df %>%
      group_by(across(all_of(by_vars))) %>%
      arrange(year) %>%
      mutate(!!lag_name := dplyr::lag(.data[[value_var]], lag)) %>%
      ungroup()
  }
  df
}

combined_data_dl <- combined_data_dl %>%
  generate_lags(
    by_vars    = c("exporter","importer","product"),
    value_var  = "value",
    n_lags     = num_lags
  ) %>%
  # drop any rows missing lag_1/2/3
  filter(if_all(starts_with("lag_"), ~ !is.na(.)))
```

```{r}
# =============================================================================
# 3) SPLIT UK EXPORT & IMPORT DATASETS
# =============================================================================
# UK as EXPORTER → partner is importer
uk_export_data <- combined_data_dl %>%
  filter(exporter == "United Kingdom") %>%
  drop_na(importer, product) %>%
  mutate(
    importer = factor(importer),  # keep as factor
    product  = factor(product)
  )

# store these for decoding
exp_imp_levels  <- levels(uk_export_data$importer)
exp_prod_levels <- levels(uk_export_data$product)

# now convert to integer codes
uk_export_data <- uk_export_data %>%
  mutate(
    importer = as.integer(importer),
    product  = as.integer(product)
  )

# UK as IMPORTER → partner is exporter
uk_import_data <- combined_data_dl %>%
  filter(importer == "United Kingdom") %>%
  drop_na(exporter, product) %>%
  mutate(
    exporter = factor(exporter),
    product  = factor(product)
  )

imp_exp_levels  <- levels(uk_import_data$exporter)
imp_prod_levels <- levels(uk_import_data$product)

uk_import_data <- uk_import_data %>%
  mutate(
    exporter = as.integer(exporter),
    product  = as.integer(product)
  )
```

```{r}
# =============================================================================
# 4) NORMALIZE NUMERIC COLUMNS
# =============================================================================
scale_all <- function(df, cols) {
  for (c in cols) df[[c]] <- scale(df[[c]])
  df
}

scale_cols <- c("value","year", paste0("lag_",1:num_lags))
uk_export_data <- scale_all(uk_export_data, scale_cols)
uk_import_data <- scale_all(uk_import_data, scale_cols)

```

```{r include=FALSE}

# =============================================================================
# 5) DEFINE & COMPILE EXPORTER LSTM MODEL
# =============================================================================
# Inputs for exporter_model: importer_id, product_id, [year + lags] sequence
X_exp   <- uk_export_data %>% select(-value,-exporter)
y_exp   <- as.numeric(uk_export_data$value)

imp_in   <- layer_input(shape=1, name="importer_input")
prod_in  <- layer_input(shape=1, name="product_input")
num_in   <- layer_input(shape=c(ncol(X_exp)-2,1), name="numeric_input")

imp_emb  <- imp_in  %>% layer_embedding(input_dim=max(X_exp$importer)+1, output_dim=10) %>% layer_flatten()
prod_emb <- prod_in %>% layer_embedding(input_dim=max(X_exp$product)+1,  output_dim=10) %>% layer_flatten()

# project & repeat embeddings
emb_rep  <- layer_concatenate(list(imp_emb, prod_emb)) %>%
             layer_dense(20, activation="relu") %>%
             layer_repeat_vector(ncol(X_exp)-2)

merged   <- layer_concatenate(list(emb_rep, num_in), axis=-1) %>%
              layer_lstm(32) %>%
              layer_dense(16, activation="relu") %>%
              layer_dense(1, dtype="float32")

exporter_model <- keras_model(list(imp_in,prod_in,num_in), merged)
exporter_model %>% compile(
  loss      = "mse",
  optimizer = optimizer_adam(),
  metrics   = "mae"
)

```


```{r include=FALSE}

# =============================================================================
# 6) TRAIN EXPORTER MODEL
# =============================================================================
numeric_array_exp <- X_exp %>%
  select(year, starts_with("lag_")) %>%
  as.matrix() %>%
  array(dim=c(nrow(.), ncol(.), 1))

exporter_history <- exporter_model %>% fit(
  x = list(
    importer_input = as.integer(X_exp$importer),
    product_input  = as.integer(X_exp$product),
    numeric_input  = numeric_array_exp
  ),
  y               = y_exp,
  epochs          = 5,
  batch_size      = 216,
  validation_split= 0.2,
  shuffle         = TRUE
)

```
# Exporter moded training 

Figure X illustrates the exporter model's training history over 20 epochs, loss (top) and mean absolute error (MAE, bottom) for training and validation sets.
Loss: Training loss drops rapidly in a matter of the first 5 epochs and plateau rapidly towards zero. Validation loss behaves just so, leveling off at the same place without diverging, which is very likely to be an Outward Sign that the model is picking up non-overfitting patterns.
MAE: The mean absolute error also follows similarly, with both training and validation MAE plummeting sharply in the early stages and then plateauing slightly above 0.3. The proximity of the two MAE curves to each other throughout the training process also attests to the model's stability.

Generally, the training record indicates fast convergence, minimal final error, and good agreement between training and test performance. This is a sign that the model effectively learns the pattern hidden in the export data and is capable of generating good-quality forecasts.



```{r}
plot(exporter_history) + ggtitle("Exporter Model Training History")
```

```{r include=FALSE }
# =============================================================================
# 7) DEFINE & COMPILE IMPORTER LSTM MODEL
# =============================================================================
X_imp   <- uk_import_data %>% select(-value,-importer)
y_imp   <- as.numeric(uk_import_data$value)

imp2_in   <- layer_input(shape=1, name="exporter_input")
prod2_in  <- layer_input(shape=1, name="product_input")
num2_in   <- layer_input(shape=c(ncol(X_imp)-2,1), name="numeric_input")

exp_emb   <- imp2_in  %>% layer_embedding(input_dim=max(X_imp$exporter)+1, output_dim=10) %>% layer_flatten()
prod2_emb <- prod2_in %>% layer_embedding(input_dim=max(X_imp$product)+1,  output_dim=10) %>% layer_flatten()

emb2_rep  <- layer_concatenate(list(exp_emb, prod2_emb)) %>%
              layer_dense(20, activation="relu") %>%
              layer_repeat_vector(ncol(X_imp)-2)

merged2    <- layer_concatenate(list(emb2_rep, num2_in), axis=-1) %>%
               layer_lstm(32) %>%
               layer_dense(16, activation="relu") %>%
               layer_dense(1, dtype="float32")

importer_model <- keras_model(list(imp2_in,prod2_in,num2_in), merged2)
importer_model %>% compile(
  loss      = "mse",
  optimizer = optimizer_adam(),
  metrics   = "mae"
)



```


```{r include=FALSE}

# =============================================================================
# 8) TRAIN IMPORTER MODEL
# =============================================================================
numeric_array_imp <- X_imp %>%
  select(year, starts_with("lag_")) %>%
  as.matrix() %>%
  array(dim=c(nrow(.), ncol(.), 1))

importer_history <- importer_model %>% fit(
  x = list(
    exporter_input = as.integer(X_imp$exporter),
    product_input  = as.integer(X_imp$product),
    numeric_input  = numeric_array_imp
  ),
  y               = y_imp,
  epochs          = 5,
  batch_size      = 216,
  validation_split= 0.2,
  shuffle         = TRUE
)

```
# Importer Model Training

Figure X presents the importer model's training history across 20 epochs, both loss (top) and mean absolute error (MAE, bottom) for training and validation sets.

In the top panel, training loss (MSE) diminishes steadily and then levels off after approximately epoch 10. Validation loss also decreases initially but levels off at a higher value, being relatively stable but always above the training curve. This discrepancy indicates that while the model generalizes quite well, it may not be entirely catching on to the complexity of some import dynamics.

In the bottom panel, training MAE goes down predictably and plateaus just above 0.22. Validation MAE begins higher and wobbles around throughout, stabilizing from epoch 12 and beyond. While there is some quiver in the validation curve, there is no suggestion of overfitting, and the model's behavior remains nicely behaved throughout.

Generally, the importer model exhibits strong learning and good convergence, albeit with somewhat less flexibility compared to the exporter model. Its generalization is consistent enough for good forecasting, especially in light of the necessarily more volatile nature of import flows.

```{r}
plot(importer_history) + ggtitle("Importer Model Training History")
```

```{r}
# =============================================================================
# 9) FORECAST HELPER & EXECUTION
# =============================================================================
make_forecast_fast <- function(
  model, train_df, years,
  cat1_vals, cat2_vals,
  year_mean, year_sd,
  cat1_name = "importer_input",
  cat2_name = "product_input",
  batch_size = NULL,
  workers = 4,
  use_multiprocessing = TRUE
) {
  # 1) Construct the grid with CJ()
  dt <- data.table::CJ(year = years, cat1 = cat1_vals, cat2 = cat2_vals)
  dt[, paste0("lag_", 1:3) := 0L]      # zero‑fill lags
  dt[, year := (year - year_mean) / year_sd]  # scale years in place

  # 2) Build the numeric tensor
  m     <- as.matrix(dt[, .(year, lag_1, lag_2, lag_3)])
  num_arr <- array(m, dim = c(nrow(m), ncol(m), 1))  # <-- use nrow() here

  # 3) Assemble inputs
  inputs <- list()
  inputs[[cat1_name]]      <- dt$cat1
  inputs[[cat2_name]]      <- dt$cat2
  inputs[["numeric_input"]] <- num_arr

  # 4) Predict in one big batch
  if (is.null(batch_size)) batch_size <- nrow(dt)
  preds <- model %>% predict(
    inputs,
    batch_size          = batch_size,
    verbose             = 0,
    workers             = workers,
    use_multiprocessing = use_multiprocessing
  )

  # 5) Back‑transform
  dt[, predicted_value := as.numeric(
    preds * attr(train_df$value, "scaled:scale") +
    attr(train_df$value, "scaled:center")
  )]

  dt
}

# Forecast years
future_years <- 2020:2030

# (a) Exporter side (UK → partner/import combos)
export_forecast <- make_forecast_fast(
  model       = exporter_model,
  train_df    = uk_export_data,
  years       = future_years,
  cat1_vals   = sort(unique(X_exp$importer)),
  cat2_vals   = sort(unique(X_exp$product)),
  year_mean   = attr(uk_export_data$year,"scaled:center"),
  year_sd     = attr(uk_export_data$year,"scaled:scale"),
  cat1_name   = "importer_input",
  cat2_name   = "product_input"
)

# (b) Importer side (UK ← partner/export combos)
import_forecast <- make_forecast_fast(
  model       = importer_model,
  train_df    = uk_import_data,
  years       = future_years,
  cat1_vals   = sort(unique(X_imp$exporter)),
  cat2_vals   = sort(unique(X_imp$product)),
  year_mean   = attr(uk_import_data$year,"scaled:center"),
  year_sd     = attr(uk_import_data$year,"scaled:scale"),
  cat1_name   = "exporter_input",   # matches importer_model’s first input
  cat2_name   = "product_input"
)

export_forecast <- export_forecast %>%
  mutate(
    importer_name = exp_imp_levels[cat1],   # correct mapping
    product_name  = exp_prod_levels[cat2]
  )

# decode import forecast
import_forecast <- import_forecast %>%
  mutate(
    exporter_name = imp_exp_levels[cat1],   # correct mapping
    product_name  = imp_prod_levels[cat2]
  )
```
## Summary of training
In the exporter and importer models, training histories are well-converging and stable. Quick reduction in training loss as well as MAE occurs in the first 5 epochs in the exporter model, and then there is a flat plateau at low levels of error. Perhaps most importantly, the validation curves are barely distinguishable from training throughout, demonstrating excellent generalization and minimal overfitting. This implies that the model does capture the export trade activity and is highly stable across epochs.

The importer model also converges reasonably well, but with more variability. While training loss and MAE still reduce and plateau early, the validation curves are consistently higher, with minor fluctuations beginning with epoch 10. This persisting gap reflects slightly lower generalization ability, possibly due to more complex or noisy import streams. The model remains stable across epochs, though, and never overfits.

Collectively, both training curves reflect stable learning patterns. The exporter model is more accurate at generalization, while the importer model is slightly more cautious but still stable. These models form a robust foundation for making UK trade flows forecasts over time.

# Results
## Forecasted Total Trade Overview
Figure X plots the forecast UK trade trajectory from 2020 to 2030 via an autoregressive LSTM model that bases its forecasts on lagged trade values. Export values (blue) and import values (red) are relatively flat, with no sign of growth or decline. Imports are consistently greater than exports across the full forecast horizon, creating a consistent but not increasing trade deficit as represented by the dashed black line.

The autoregressive character of the model with lag variables (lag_1 to lag_3) puts greater emphasis on the explanatory role of past trade values. This level forecast trajectory indicates that past trade trends of the UK are likely to go on without drastic disruption or revision. The model does not predict significant structural change, rather illustrating ingrained trade dependencies and modest development of trading partnerships over the short term.

```{R}
# ——————————————————————————————————————————
# 1) Recover the un‑scaled “year” for plotting & grouping
# ——————————————————————————————————————————
export_forecast <- export_forecast %>%
  mutate(
    year = year * attr(uk_export_data$year, "scaled:scale") +
           attr(uk_export_data$year, "scaled:center")
  )

import_forecast <- import_forecast %>%
  mutate(
    year = year * attr(uk_import_data$year, "scaled:scale") +
           attr(uk_import_data$year, "scaled:center")
  )

# ——————————————————————————————————————————
# 2) Compute annual totals
# ——————————————————————————————————————————
export_totals <- export_forecast %>%
  group_by(year) %>%
  summarise(export_value = sum(predicted_value), .groups = "drop")

import_totals <- import_forecast %>%
  group_by(year) %>%
  summarise(import_value = sum(predicted_value), .groups = "drop")

combined_totals <- full_join(export_totals, import_totals, by = "year") %>%
  mutate(
    net_trade = import_value - export_value
  )

# ——————————————————————————————————————————
# 3) Plot forecasted exports, imports & net trade
# ——————————————————————————————————————————
ggplot(combined_totals, aes(x = year)) +
  geom_line(aes(y = export_value, color = "Exports"), size = 1) +
  geom_line(aes(y = import_value, color = "Imports"), size = 1) +
  geom_line(aes(y = net_trade, color = "Net Balance"),
            linetype = "dashed", size = 1) +
  scale_color_manual(
    values = c("Exports" = "blue", "Imports" = "red", "Net Balance" = "black")
  ) +
  labs(
    title = "UK Trade Forecast (2020–2030)",
    x     = "Year",
    y     = "Predicted Trade Value",
    color = ""
  ) +
  theme_minimal()

```

# Export top 10 producs

Figure X shows forecast UK export values for the top 10 product categories between the years 2020 and 2030. Every category, from metals, petroleum products, and engines to vehicles, is marked by constant but low rises. No product has any sign of high peaks or swift reversals, and the relative ranking among the product categories is more or less constant throughout the forecast period.

This homogeneity and smooth upsurge match the autoregressive nature of the LSTM model, with lagged past levels of trade determining its projections. Given that the model uses only previous trade data and excludes exogenous shocks and policy intervention, the model produces smooth, cautious forecasts that are concentrated on momentum and continuity instead of disruption. As such, the results reflect stable long-term trends rather than dramatic shifts in patterns of exports.

```{R}
# -----------------------------------------------------------------------------
# A) Compute the TRUE Top‑10 lists by raw (untransformed) value
# -----------------------------------------------------------------------------
# 1) Top‑10 export products & partner countries
uk_raw_export <- combined_data %>% filter(exporter == "United Kingdom")
top10_export_product_names  <- uk_raw_export %>%
  group_by(product) %>%
  summarise(total_value = sum(value, na.rm=TRUE), .groups="drop") %>%
  slice_max(total_value, n = 10) %>%
  pull(product)
top10_export_country_names  <- uk_raw_export %>%
  group_by(importer) %>%
  summarise(total_value = sum(value, na.rm=TRUE), .groups="drop") %>%
  slice_max(total_value, n = 10) %>%
  pull(importer)

# 2) Top‑10 import products & partner countries
uk_raw_import <- combined_data %>% filter(importer == "United Kingdom")
top10_import_product_names  <- uk_raw_import %>%
  group_by(product) %>%
  summarise(total_value = sum(value, na.rm=TRUE), .groups="drop") %>%
  slice_max(total_value, n = 10) %>%
  pull(product)
top10_import_country_names  <- uk_raw_import %>%
  group_by(exporter) %>%
  summarise(total_value = sum(value, na.rm=TRUE), .groups="drop") %>%
  slice_max(total_value, n = 10) %>%
  pull(exporter)


# -----------------------------------------------------------------------------
# B) Decode your forecasts into human‐readable names
# -----------------------------------------------------------------------------
# (Assuming you saved these factor‐level vectors when you encoded your training data)
#   exp_imp_levels, exp_prod_levels  for the exporter model
#   imp_exp_levels, imp_prod_levels  for the importer model

export_forecast <- export_forecast %>%
  mutate(
    year          = year * attr(uk_export_data$year, "scaled:scale") +
                    attr(uk_export_data$year, "scaled:center"),
    product_name  = exp_prod_levels[cat2],
    importer_name = exp_imp_levels[cat1]
  )

import_forecast <- import_forecast %>%
  mutate(
    year          = year * attr(uk_import_data$year, "scaled:scale") +
                    attr(uk_import_data$year, "scaled:center"),
    product_name  = imp_prod_levels[cat2],
    exporter_name = imp_exp_levels[cat1]
  )
# -----------------------------------------------------------------------------
# C) Plot 1: Export ‑ Top‑10 Products
# -----------------------------------------------------------------------------
export_forecast %>%
  filter(product_name %in% top10_export_product_names) %>%
  ggplot(aes(x = year, y = predicted_value, color = product_name)) +
    stat_summary(fun = sum, geom = "line", size = 1) +
    labs(
      title = "Forecasted UK Exports by Top 10 Products",
      x     = "Year",
      y     = "Total Predicted Export Value",
      color = "Product"
    ) +
    theme_minimal()

```

# Import top 10 producs

Figure X illustrates the projected import values of the UK's top 10 product categories from 2020 to 2030. Importation of vehicles, petroleum goods, machinery for data processing, and transmission equipment all rise gradually, some—particularly electronics and machines—rising with higher increasing trends. Other goods, such as metals and plastics, also rise gradually, yet none of the top categories decline throughout the years.

These gradual uptrends are typical of the autoregressive process of the LSTM model in generating forecasts using historic lagged values of trades. The model features no external shocks or demand adjustments, and accordingly, its estimates tend to mirror current momentum within the data. While this results in smooth, cautious growth profiles, this could potentially be overly conservative for forecasted future import demand and mask potential volatility or nonlinear sector shifts. Yet, the model suggests a steep and broad-based increase in UK import dependence in key industries.

```{r}
# -----------------------------------------------------------------------------
# E) Plot 3: Import ‑ Top‑10 Products
# -----------------------------------------------------------------------------
import_forecast %>%
  filter(product_name %in% top10_import_product_names) %>%
  ggplot(aes(x = year, y = predicted_value, color = product_name)) +
    stat_summary(fun = sum, geom = "line", size = 1) +
    labs(
      title = "Forecasted UK Imports by Top 10 Products",
      x     = "Year",
      y     = "Total Predicted Import Value",
      color = "Product"
    ) +
    theme_minimal()

```

# Export top 10 Countries

Figure X shows projected UK export values to its 10 biggest major international trading partners between 2020 and 2030. The USA will remain the largest export market, followed by Germany and the Netherlands in second and third places, respectively. All of the countries show steady upward trends, demonstrating healthy and strong export growth in the UK's most important trade relationships.

```{r}
# -----------------------------------------------------------------------------
# D) Plot 2: Export ‑ Top‑10 Partner Countries
# -----------------------------------------------------------------------------
export_forecast %>%
  filter(importer_name %in% top10_export_country_names) %>%
  ggplot(aes(x = year, y = predicted_value, color = importer_name)) +
    stat_summary(fun = sum, geom = "line", size = 1) +
    labs(
      title = "Forecasted UK Exports to Top 10 Countries",
      x     = "Year",
      y     = "Total Predicted Export Value",
      color = "Country"
    ) +
    theme_minimal()

```

# Import top 10 countries
Figure X illustrates forecasted import values from the UK's top 10 source nations between 2020 and 2030. Germany and China are still leading suppliers, with the USA, France, and the Netherlands still key contributors. Most notably, Norway has the group's most precipitous increase, which may indicate a potential shift in energy or commodity-led imports.

All countries have smooth, rising trends with no country declining based on forecast. Smooth trajectories validate the behavior of the autoregressive LSTM model to sustain previous trade momentum while ignoring short-run variations. Generally, the forecasts suggest sustained or growing reliance on leading international suppliers and therefore validate the UK's structural import dependence

```{r}
# -----------------------------------------------------------------------------
# F) Plot 4: Import ‑ Top‑10 Partner Countries
# -----------------------------------------------------------------------------
import_forecast %>%
  filter(exporter_name %in% top10_import_country_names) %>%
  ggplot(aes(x = year, y = predicted_value, color = exporter_name)) +
    stat_summary(fun = sum, geom = "line", size = 1) +
    labs(
      title = "Forecasted UK Imports from Top 10 Countries",
      x     = "Year",
      y     = "Total Predicted Import Value",
      color = "Country"
    ) +
    theme_minimal()
```
## Deep learning conclusion

This paper trained two deep learning models that predict UK international trade: one where it represents the UK as an importer and the other as an exporter. Both were trained using embedded representations of categorical features (e.g., partner country, product) and numeric time-series features such as year and lagged trade value normalized and fed into LSTM layers so that the models can learn sequential dependencies. Training in the models was uniform, with no sign of overfitting, and validation losses were close to training curves.

Forecasts produced by these models were mostly smooth and tended upward, consistent across the majority of products and counterparties. This is a manifestation of the autoregressive structure of the system: each forecast is computed from lagged historical values and projected far in the future along the time axis. While strong at mimicking historical momentum and avoiding volatility, the models undercapture inflection points, shocks, or sudden changes in behavior—especially in the absence of real-time indicators or exogenous variables like policy change or economic dislocations.

Additionally, although earlier correlation and clustering analysis revealed strong structure—particularly between industrial product categories and trade partners—this structural information was not actually utilized by the model. All the inputs were treated in a standard way. There are opportunities in future work to introduce structured priors, e.g., graph-based representations or pre-clustered embeddings, to improve regime differentiation of trade activity.

Lastly, these deep learning models provide a reasonable baseline forecast based on past patterns of trade. Their comparative advantage lies in detecting long-term trends, and they must be viewed as directional forecasts under perpetual economic assumptions. For reactive short-term forecasting, hybrid methods or additional macroeconomic variables would likely be needed to fully capture the sheer complexity of global trade.


# Final conclusion

This paper strived to uncover whether future UK trade values—total trade, products, and partners—may be precisely projected using modern data-driven techniques. Based on an integrated methodology which combined large-scale exploratory analysis, correlation and clustering, and deep learning-based prediction, this study offers UK trade architecture insights as well as a foundation for predictive models of the future.

The visual and exploratory analyses reaffirmed the UK's long-standing structural trade deficit and confirmed its over-dependence on a small number of key trade partners—most notably the USA, Germany, and China. Trade was controlled by a small number of high-value sectors such as vehicles, pharmaceuticals, petroleum, and machinery, each of which was highly sensitive to such economic disruptions as the 2008 crisis, Brexit, and the COVID-19 pandemic. Correlation matrices also identified significant industrial co-movement within industries and within regional trade blocs, particularly in Europe, and clustering uncovered natural groupings among products and countries that suggest hidden structure in the trading network.

In the predictive modeling process, two deep learning models were trained, one to simulate the UK as an exporter and the other as an importer. Both models were built using LSTM architectures that could incorporate time-dependent patterns using lagged trade values in addition to embedded representations of one-hot-encoded inputs. Both models performed well consistently in training with stable convergence and good generalization, with minimal overfitting.

Forecasts from 2020 to 2030 anticipate smooth, momentum-driven growth in trade, especially in prime sectors and nations. Imports are anticipated to increase steadily to the USA, Germany, and the Netherlands, while exports to Germany, China, and Norway are also anticipated to continue increasing. However, the autoregressive structure of models—on prior levels of trade and without the addition of any exogenous variable—does not allow them to predict future dislocations or turning points. As such, the forecasts need to be interpreted as baseline predictions under persistence of current trends.

A limitation is that while prior work showed underlying structures through clustering and correlation, these were not incorporated into the deep learning models. Future work could explore hybrid architectures that integrate these findings—via graph neural networks or cluster-aware embeddings—into more interpretable and forecasting-capable models.

In conclusion, deep learning provides a rich tool with which to analyze and forecast UK trade flows. While it is best when detecting long-term momentum, its use has limitations when faced with unexpected events or policy shifts. A combination of such models with macroeconomic variables, international variables, or expert judgment may be the next step in creating an even richer, dynamic, and more robust forecasting system.
# Reference

https://www.cepii.fr/CEPII/en/bdd_modele/bdd_modele_item.asp?id=37

# appendix
All code and supporting documents are available on github in the following perma link

https://github.com/maxaus2002/ASSESSMENT-2-for-MAST7220/tree/4ee2afca34a870aa6cfba57fd4bb3f3344b36c84
